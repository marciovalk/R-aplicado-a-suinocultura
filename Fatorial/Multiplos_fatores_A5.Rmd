---
title: |
  | MAT02014 - Planejamento de Experimentos II
  | Experimentos com múltiplos fatores
author: |
  | Rodrigo Citton P. dos Reis
  | `rodrigocpdosreis@gmail.com`
  |
  | Universidade Federal do Rio Grande do Sul
  | Instituto de Matemática e Estatística
  | Departamento de Estatística
date: |
  | Porto Alegre, 2018
output:
  revealjs::revealjs_presentation:
    css: estilo.css
    theme: night
    highlight: kate
    center: true
    self_contained: false
    reveal_plugins: ["chalkboard","zoom"]
  beamer_presentation:
    theme: "AnnArbor"
    colortheme: "dolphin"
    fonttheme: "structurebold"
    includes: 
      in_header: mystyle.tex
    keep_tex: true
---

# Delineamentos fatoriais com múltiplos fatores

## Introdução

- Vimos que delineamentos fatoriais de dois fatores são mais eficientes do que estudar cada fator separadamente em projetos de um fator.
- Da mesma forma, quando muitos fatores estão em estudo, é mais eficiente estudá-los juntos em um planejamento fatorial __multifatorial__ do que estudá-los separadamente em grupos de dois usando delineamentos fatoriais de dois fatores.
- Quando múltiplos fatores são estudados simultaneamente, o poder para detectar efeitos principais é maior sobre o que seria em experimentos fatoriais separados de dois fatores.
- Além disso, a possibilidade de detectar interações entre qualquer um dos fatores é possível.

## Introdução

- Se os fatores fossem estudados separadamente (em delineamentos fatoriais de dois fatores), interações de dois fatores só poderiam ser detectadas entre fatores estudados juntos no mesmo desenho.
- Em um fatorial multifatorial, não só é possível detectar interações de dois fatores entre qualquer par de fatores, mas também é possível detectar __interações de ordem superior__ entre grupos de fatores.
- Uma interação de três fatores entre os fatores $A$, $B$ e $C$, por exemplo, significa que o efeito do fator $A$ difere dependendo da combinação dos níveis dos fatores $B$ e $C$.

## Introdução

- As combinações de __tratamento__ em um fatorial multifatorial consistem em todas as combinações possíveis dos níveis de todos os fatores.
- __Pergunta 1:__ Faça a combinação dos níveis de 3 fatores, no caso em que cada um destes apresenta dois níveis.
- __Pergunta 2:__ Como você faria isto no seu software?
- O modelo para análise é uma extensão do modelo proposto para delineamentos fatoriais de dois fatores, e a análise pode ser feita usando a função `lm` do `R` similar aos exemplos mostrados anteriormente.

## Exemplo

- Considere um exemplo de um planejamento fatorial multifatorial em pesquisa de _marketing_. 
- Uma empresa cujas vendas são feitas _on-line_ por meio de uma página da _Web_ gostaria de aumentar a proporção de visitantes de seu site que se inscrevem em seus serviços configurando de forma ideal sua página da _web_.

## Exemplo

- Para comprar na empresa, os clientes devem se inscrever e preencher um formulário fornecendo seu endereço de _e-mail_ junto com outros campos necessários.
- Uma vez que um cliente se inscreve, a empresa tem informações de contato para seu banco de dados e pode enviar por _e-mail_ com propagandas, ofertas especiais e assim por diante.
- A empresa gostaria de experimentar testando diferentes configurações de sua página da _Web_ para ver se eles podem aumentar o número de visitantes do site que realmente se inscreveram.

## Exemplo

- As unidades experimentais neste estudo serão os indivíduos que visitam o site da empresa.
- A resposta é __binária__: o cliente ou __se inscreve__ ou __não se inscreve__.
- Os fatores em estudo são características que alteram a aparência da página da _Web_.
    + O __fator $A$__ representa as alternativas de segundo plano (plano de fundo) para a página com três opções.
    + O __fator $B$__ é o tamanho da fonte na faixa principal, com três níveis.
    + O __fator $C$__ é a cor do texto, com duas alternativas.
    + O __fator $D$__ é uma escolha entre um botão de inscrição ou um link.

## Exemplo

- Com base nesses fatores, existem __3 × 3 × 2 × 2 = 36__ possíveis configurações da página da Web ao considerar todas as combinações possíveis dos níveis de cada fator.
- Um experimento fatorial de __quatro fatores__ consiste em atribuir aleatoriamente visitantes ao site a uma das possíveis configurações e registrar sua resposta binária.
- Existem variáveis ocultas que podem afetar a chance de um visitante do site se inscrever.
    + Por exemplo, a ordem de posição em que o link (para o site da empresa) aparece em uma pesquisa na Web para os produtos que eles vendem, promoções oferecidas pelos concorrentes e atratividade dos sites dos concorrentes.
- A designação aleatória de cada visitante sequencial do site para uma das configurações alternativas em estudo deve minimizar a chance de viés de alterações nas variáveis ocultas ao longo do tempo.

## _Das model_

![dasmodel](images/dasmodel.jpg)

## _Das model_

- A probabilidade de um visitante do site se inscrever pode ser expressa pelo modelo:

![dasmodel2](images/dasmodel_multifactor.png)

- $\alpha_i$ representa o efeito do plano de fundo;
- $\beta_j$ representa o efeito do tamanho da fonte na faixa principal;
- $\gamma_k$ representa o efeito da cor do texto;
- $\delta_l$ representa o efeito do botão _vs_ o link para inscrição.

## Exemplo

- O experimento foi conduzido através da construção de 36 sites, consistindo de todas as combinações possíveis dos quatro fatores descritos.
- Cada cliente em potencial que visitou o site da empresa durante o período de teste foi redirecionado __aleatoriamente__ para uma das 36 configurações. 
- O número de visitantes $n_{ijkl}$ da versão $ijkl$ e o número que se inscreveu $x_{ijkl}$ foram registrados.
- O $x_{ijkl}$ é então distribuído conforme uma distribuição binomial:

![binomial](images/binomial_multifactor.png)

## Exemplo (R)

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(daewr)
data(web)
head(web)
```

## Exemplo

- Poderíamos tentar transformar os dados (as proporções amostrais).
- Uma alternativa mais elegante, e com resultados teóricos interessantes é o uso do __modelo logístico__.
- O modelo logístico é um modelo que faz parte da classe dos __modelos lineares generalizados__ (_MLG_ ou _GLM_).

### (Pausa)

- Para avaliarmos as hipóteses usuais, utilizaremos a __análise do desvio__ (_Analys of Deviance_; ANODEV).
    + É uma generalização da análise de variância para os MLG.

## Exemplo (R)

- __Sua vez:__ ao nível de 5% de significância, o que podemos falar dos efeitos principais? E dos efeitos de interação?

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
modb <- glm( cbind(signup, visitors-signup) ~ A * B * C * D,
             data = web, family = binomial )
anova(update(modb, .~ A+B + A:B + C + A:C + B:C + A:B:C + D + A:D + B:D + A:B:D + C:D + A:C:D + B:C:D + A:B:C:D),
      test = "Chisq")
```

## Exemplo (R)

```{r eval=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
prop <- web$signup / web$visitors
webp <- data.frame(web, prop)
par(mfrow = c(1,3))
webp1 <- subset(webp, A == 1)
interaction.plot(webp1$C, webp1$D, webp1$prop, type = "l",
                 legend=FALSE, ylim = c(.015,.0275), main = "Background = 1",
                 xlab = "Text Color", ylab = "Proportion Signing-up")
webp2 <- subset(webp, A == 2 )
interaction.plot( webp2$C, webp2$D, webp2$prop, type = "l", legend = FALSE, ylim = c(.015,.0275), main = "Background = 2",
                  xlab = "Text Color", ylab = " ")
lines( c(1.7,1.85), c(.016,.016), lty = 2)
lines( c(1.7,1.85), c(.017,.017) ,lty = 1)
text(1.3, .017, "Sign-up link ")
text(1.3, .016, "Sign-up Button" )
text(1.4, .018, "LEGEND" )
webp3 <- subset(webp, A == 3)
interaction.plot(webp3$C, webp3$D, webp3$prop, type = "l",
                 legend=FALSE, ylim = c(.015,.0275), main="Background = 3",
                 xlab = "Text Color", ylab = " ")
```

## Exemplo (R)

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
prop <- web$signup / web$visitors
webp <- data.frame(web, prop)
par(mfrow = c(1,3))
webp1 <- subset(webp, A == 1)
interaction.plot(webp1$C, webp1$D, webp1$prop, type = "l",
                 legend=FALSE, ylim = c(.015,.0275), main = "Background = 1",
                 xlab = "Text Color", ylab = "Proportion Signing-up")
webp2 <- subset(webp, A == 2 )
interaction.plot( webp2$C, webp2$D, webp2$prop, type = "l", legend = FALSE, ylim = c(.015,.0275), main = "Background = 2",
                  xlab = "Text Color", ylab = " ")
lines( c(1.7,1.85), c(.016,.016), lty = 2)
lines( c(1.7,1.85), c(.017,.017) ,lty = 1)
text(1.3, .017, "Sign-up link ")
text(1.3, .016, "Sign-up Button" )
text(1.4, .018, "LEGEND" )
webp3 <- subset(webp, A == 3)
interaction.plot(webp3$C, webp3$D, webp3$prop, type = "l",
                 legend=FALSE, ylim = c(.015,.0275), main="Background = 3",
                 xlab = "Text Color", ylab = " ")
```

## Conclusões

- Ao usar o tipo de segundo plano 2 ou tipo 3, pode-se observar que a alteração da cor do texto de preto = 1 para branco = 2 causa um aumento na proporção de visitantes do site que se inscrevem.
- O aumento (representado pela inclinação das linhas) é maior quando um botão de inscrição é usado, em vez de um link de inscrição, porque a taxa de inscrição geral é maior quando um link é usado, independentemente da cor do texto.
    + Não há muito espaço para melhorias.
- No entanto, quando o tipo de plano de fundo 1 é usado, o efeito da cor do texto é completamente diferente.
    + Nesse caso, alterar a fonte de preto = 1 para branco = 2 causa uma diminuição na proporção quando um botão de inscrição é usado, e há um grande aumento na proporção de inscristos ao mudar de fonte preta para branca ao usar um link de inscrição.
    + Este é o oposto dos efeitos vistos para os tipos de fundo 2 e 3.

## Para casa (para aula)

- Construa a tabela de análise de variância para o caso multifatorial com resposta normal.
- Discuta outras aplicações que você considera que o delineamento fatorial com múltiplos fatores é apropriado.

![statcaco](images/stat_caco.gif)